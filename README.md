# PyPI Security MCP

Инструмент для анализа безопасности Python пакетов с использованием OSV.dev API и интеграции с ИИ для предоставления структурированного анализа уязвимостей.

## Описание

PyPI Security MCP - это система для сканирования Python пакетов на предмет известных уязвимостей безопасности. Проект состоит из двух основных компонентов:

- **MCP сервер** (`server.py`) - предоставляет API для запросов к базе данных уязвимостей OSV.dev
- **Клиент с ИИ-анализом** (`client.py`) - использует LangChain и DeepSeek для анализа и структурированного представления результатов

## Архитектура системы

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│                 │    │                  │    │                 │
│   Client.py     │◄──►│   Server.py      │◄──►│   OSV.dev API   │
│                 │    │                  │    │                 │
│ ┌─────────────┐ │    │ ┌──────────────┐ │    │ ┌─────────────┐ │
│ │ LangChain   │ │    │ │ FastMCP      │ │    │ │ Vulnerablty │ │
│ │ Agent       │ │    │ │ Server       │ │    │ │ Database    │ │
│ └─────────────┘ │    │ └──────────────┘ │    │ └─────────────┘ │
│                 │    │                  │    │                 │
│ ┌─────────────┐ │    │ HTTP API         │    │ JSON Response   │
│ │ DeepSeek    │ │    │ :9000/mcp        │    │                 │
│ │ LLM         │ │    │                  │    │                 │
│ └─────────────┘ │    │                  │    │                 │
└─────────────────┘    └──────────────────┘    └─────────────────┘



┌─────────────────────────────────────────────────────────────────┐
│                    Workflow                                     │
│                                                                 │
│ 1. Пользователь запрашивает анализ пакета                       │
│ 2. Client отправляет запрос на MCP Server                       │
│ 3. Server делает запрос к OSV.dev API                           │
│ 4. OSV.dev возвращает данные об уязвимостях                     │
│ 5. Server передает JSON обратно Client                          │
│ 6. LangChain Agent анализирует данные через DeepSeek            │
│ 7. Возвращается структурированный отчет с рекомендациями        │
└─────────────────────────────────────────────────────────────────┘
```

## Возможности

- 🔍 Сканирование конкретных версий PyPI пакетов на уязвимости
- 🤖 ИИ-анализ результатов с помощью DeepSeek API
- 📊 Структурированное представление уязвимостей по критичности
- 💡 Рекомендации по обновлению или замене пакетов
- 🚨 Выявление критических уязвимостей и предложение альтернатив

## Установка

### Требования

- Python 3.12+
- API ключ DeepSeek (для ИИ-анализа)

### Шаги установки

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd pypi-security-mcp
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` в корне проекта:
```env
DEEPSEEK_API_KEY=your_deepseek_api_key_here
DEEPSEEK_API_BASE=https://api.deepseek.com/v1
```

## Запуск

### 1. Запуск MCP сервера

В первом терминале:
```bash
python server.py
```

Сервер запустится на `http://127.0.0.1:9000`

### 2. Запуск клиента

Во втором терминале:
```bash
python client.py
```

По умолчанию клиент проанализирует пакет `jinja2` версии `2.4.1`. Для анализа других пакетов измените строку 59 в `client.py`:

```python
query = "Проанализируй уязвимости для пакета <package_name> версии <version>"
```

## Структура проекта

```
pypi-security-mcp/
├── server.py          # MCP сервер для работы с OSV.dev API
├── client.py           # Клиент с ИИ-анализом
├── pyproject.toml      # Конфигурация проекта
├── requirements.txt    # Зависимости Python
├── uv.lock            # Lock-файл для uv
└── README.md          # Документация
```

## Пример вывода

Клиент предоставляет структурированный анализ:
- 📊 Общее количество найденных уязвимостей
- 🚨 Классификация по уровню критичности
- 📋 Описание наиболее опасных уязвимостей  
- ✅ Рекомендации по обновлению
- 🔄 Альтернативные пакеты при критических уязвимостях

## API Reference

### MCP Tools

#### `scan_pypi_package`
- **Параметры**: 
  - `package_name` (str) - название пакета
  - `package_version` (str) - версия пакета
- **Возвращает**: JSON с данными об уязвимостях из OSV.dev

## Технологии

- **FastMCP** - для создания MCP сервера
- **LangChain** - для работы с ИИ агентами
- **DeepSeek API** - для анализа уязвимостей
- **OSV.dev** - база данных уязвимостей с открытым исходным кодом
- **Requests** - для HTTP запросов

## Лицензия

Этот проект предназначен для оборонительных целей безопасности и анализа уязвимостей.